<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ตารางนัดหมอต้อง</title>
    
    <!-- iOS Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="หมอต้อง">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f0fdf4;
            overscroll-behavior-y: none;
            -webkit-tap-highlight-color: transparent;
        }
        .calendar-grid-5 {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 4px;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Remove arrows from number input */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

        .bg-pattern-holiday {
            background-color: #fef2f2;
            background-image: repeating-linear-gradient(45deg, #fee2e2 25%, transparent 25%, transparent 75%, #fee2e2 75%, #fee2e2), repeating-linear-gradient(45deg, #fee2e2 25%, #fef2f2 25%, #fef2f2 75%, #fee2e2 75%, #fee2e2);
            background-position: 0 0, 10px 10px;
            background-size: 20px 20px;
        }
        .bg-pattern-official {
            background-color: #fff1f2;
            border-color: #fda4af;
        }
        .bg-pattern-walkin {
            background-color: #fffbeb; 
            border-color: #fcd34d;
        }
        
        .sticky-month-header {
            position: sticky;
            top: 0;
            z-index: 20;
            background-color: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(4px);
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0.7); transform: scale(1); }
            50% { box-shadow: 0 0 0 10px rgba(234, 179, 8, 0); transform: scale(1.05); background-color: #fef08a; }
            100% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0); transform: scale(1); }
        }
        .warp-highlight {
            animation: highlightPulse 1s ease-out;
            border: 2px solid #eab308 !important;
            z-index: 50;
        }
    </style>
</head>
<body>
    <div id="root" class="flex items-center justify-center h-screen text-gray-400">
        กำลังโหลดระบบนัด (หมอต้อง)...
    </div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Icons ---
        const IconCalendar = () => (<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>);
        const IconCalculator = () => (<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="16" y1="14" x2="16" y2="14"></line><line x1="12" y1="14" x2="12" y2="14"></line><line x1="8" y1="14" x2="8" y2="14"></line><line x1="16" y1="18" x2="16" y2="18"></line><line x1="12" y1="18" x2="12" y2="18"></line><line x1="8" y1="18" x2="8" y2="18"></line></svg>);
        const IconLeft = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>);
        const IconRight = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>);
        const IconPlus = () => (<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="4" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>);
        const IconMinus = () => (<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="4" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line></svg>);
        const IconLock = () => (<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>);
        const IconUnlock = () => (<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 9.9-1"></path></svg>);
        const IconUser = () => (<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>);
        const IconProcedure = () => (<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="12" y1="18" x2="12" y2="12"></line><line x1="9" y1="15" x2="15" y2="15"></line></svg>);
        const IconWalk = () => (<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 11 3.8 11 8c0 2.85-1.67 5.71-3 8v6h-4v-6"></path><path d="M17 10v-1.16c0-2.48-1.03-3.34-1-6.08.03-2.56 1.49-3.76 4.5-3.76C22.37 -1 24 1.8 24 6c0 2.85-1.67 5.71-3 8v6h-4v-6"></path></svg>);

        // --- Utils ---
        const formatDateKey = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };

        const ThaiMonths = ["มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน", "กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"];
        const ThaiDaysMonFri = ["จันทร์", "อังคาร", "พุธ", "พฤหัส", "ศุกร์"];

        // *** Thai Government Holiday Database ***
        const getThaiHolidays = (year) => {
            const holidays = {
                [`${year}-01-01`]: "วันขึ้นปีใหม่",
                [`${year}-04-06`]: "วันจักรี",
                [`${year}-04-13`]: "วันสงกรานต์",
                [`${year}-04-14`]: "วันสงกรานต์",
                [`${year}-04-15`]: "วันสงกรานต์",
                // Removed May 1
                [`${year}-05-04`]: "วันฉัตรมงคล",
                [`${year}-06-03`]: "วันเฉลิมฯ ราชินี",
                [`${year}-07-28`]: "วันเฉลิมฯ ร.10",
                [`${year}-08-12`]: "วันแม่แห่งชาติ",
                [`${year}-10-13`]: "วันนวมินทรมหาราช",
                [`${year}-10-23`]: "วันปิยมหาราช",
                [`${year}-12-05`]: "วันพ่อแห่งชาติ",
                [`${year}-12-10`]: "วันรัฐธรรมนูญ",
                [`${year}-12-31`]: "วันสิ้นปี"
            };

            if (year === 2025) {
                Object.assign(holidays, {
                    "2025-02-12": "วันมาฆบูชา",
                    "2025-05-09": "วันพืชมงคล",
                    "2025-05-11": "วันวิสาขบูชา",
                    "2025-07-10": "วันอาสาฬหบูชา",
                    "2025-07-11": "วันเข้าพรรษา"
                });
            } else if (year === 2026) {
                Object.assign(holidays, {
                    "2026-03-03": "วันมาฆบูชา",
                    "2026-05-11": "วันพืชมงคล",
                    "2026-05-31": "วันวิสาขบูชา",
                    "2026-07-29": "วันอาสาฬหบูชา",
                    "2026-07-30": "วันเข้าพรรษา"
                });
            } else if (year === 2027) {
                Object.assign(holidays, {
                    "2027-02-21": "วันมาฆบูชา",
                    "2027-05-20": "วันพืชมงคล",
                    "2027-05-20": "วันวิสาขบูชา",
                    "2027-07-17": "วันอาสาฬหบูชา",
                    "2027-07-18": "วันเข้าพรรษา"
                });
            }

            // Substitution
            const finalHolidays = { ...holidays };
            Object.keys(holidays).forEach(dateStr => {
                const parts = dateStr.split('-').map(Number);
                const date = new Date(parts[0], parts[1] - 1, parts[2]); 
                const day = date.getDay(); 
                
                if (day === 0 || day === 6) {
                    const offset = day === 6 ? 2 : 1; 
                    const subDate = new Date(parts[0], parts[1] - 1, parts[2] + offset);
                    const subKey = formatDateKey(subDate);
                    
                    if (!finalHolidays[subKey]) {
                        finalHolidays[subKey] = `ชดเชย${holidays[dateStr]}`;
                    }
                }
            });
            return finalHolidays;
        };

        const App = () => {
            const [currentYear, setCurrentYear] = useState(new Date().getFullYear());
            const scrollContainerRef = useRef(null);
            const [hasScrolledToCurrent, setHasScrolledToCurrent] = useState(false);
            const [highlightedDate, setHighlightedDate] = useState(null);
            const [toastMsg, setToastMsg] = useState(null);

            // Data
            const [appointments, setAppointments] = useState(() => { try { return JSON.parse(localStorage.getItem('kramkram_hospital_opd')) || {}; } catch { return {}; } });
            const [procedures, setProcedures] = useState(() => { try { return JSON.parse(localStorage.getItem('kramkram_hospital_proc')) || {}; } catch { return {}; } });
            const [userHolidays, setUserHolidays] = useState(() => { try { return JSON.parse(localStorage.getItem('kramkram_hospital_holidays')) || {}; } catch { return {}; } });
            const [walkIns, setWalkIns] = useState(() => { try { return JSON.parse(localStorage.getItem('kramkram_hospital_walkin')) || {}; } catch { return {}; } });
            
            const [calcBaseDate, setCalcBaseDate] = useState(formatDateKey(new Date()));

            const officialHolidays = useMemo(() => getThaiHolidays(currentYear), [currentYear]);

            // Persistence
            useEffect(() => { localStorage.setItem('kramkram_hospital_opd', JSON.stringify(appointments)); }, [appointments]);
            useEffect(() => { localStorage.setItem('kramkram_hospital_proc', JSON.stringify(procedures)); }, [procedures]);
            useEffect(() => { localStorage.setItem('kramkram_hospital_holidays', JSON.stringify(userHolidays)); }, [userHolidays]);
            useEffect(() => { localStorage.setItem('kramkram_hospital_walkin', JSON.stringify(walkIns)); }, [walkIns]);

            // Auto-scroll
            useEffect(() => {
                if (!hasScrolledToCurrent) {
                    const today = new Date();
                    if (today.getFullYear() === currentYear) {
                        const monthId = `month-${today.getMonth()}`;
                        const element = document.getElementById(monthId);
                        if (element && scrollContainerRef.current) {
                            setTimeout(() => { element.scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 100);
                        }
                    }
                    setHasScrolledToCurrent(true);
                }
            }, [currentYear, hasScrolledToCurrent]);

            useEffect(() => { if(highlightedDate) setTimeout(() => setHighlightedDate(null), 2000); }, [highlightedDate]);
            useEffect(() => { if(toastMsg) setTimeout(() => setToastMsg(null), 3000); }, [toastMsg]);

            const todayStr = formatDateKey(new Date());
            
            const calculateUpcoming = (dataObj) => {
                return Object.keys(dataObj)
                    .filter(key => key >= todayStr)
                    .reduce((sum, key) => sum + (dataObj[key] || 0), 0);
            };

            const totalOpd = calculateUpcoming(appointments);
            const totalProc = calculateUpcoming(procedures);

            const changeYear = (offset) => {
                setCurrentYear(prev => prev + offset);
                setHasScrolledToCurrent(false);
            };

            // Button update
            const updateCount = (dateKey, type, change) => {
                const setter = type === 'opd' ? setAppointments : setProcedures;
                setter(prev => {
                    const currentCount = prev[dateKey] || 0;
                    return { ...prev, [dateKey]: Math.max(0, currentCount + change) };
                });
            };

            // Manual input update
            const handleManualInput = (dateKey, type, valStr) => {
                const newVal = parseInt(valStr, 10);
                const setter = type === 'opd' ? setAppointments : setProcedures;
                
                if (isNaN(newVal) || valStr === '') {
                     setter(prev => ({ ...prev, [dateKey]: 0 }));
                } else {
                     setter(prev => ({ ...prev, [dateKey]: Math.max(0, newVal) }));
                }
            };

            const toggleUserHoliday = (dateKey) => {
                setUserHolidays(prev => {
                    const newData = { ...prev };
                    if (newData[dateKey]) delete newData[dateKey];
                    else newData[dateKey] = true;
                    return newData;
                });
            };

            const toggleWalkIn = (dateKey) => {
                setWalkIns(prev => {
                    const newData = { ...prev };
                    if (newData[dateKey]) delete newData[dateKey];
                    else newData[dateKey] = true;
                    return newData;
                });
            };

            const getFutureDateInfo = (weeks) => {
                const parts = calcBaseDate.split('-').map(Number);
                const base = new Date(parts[0], parts[1] - 1, parts[2]);
                const future = new Date(base);
                future.setDate(base.getDate() + (weeks * 7));
                const d = future.getDate();
                const m = ThaiMonths[future.getMonth()];
                const y = future.getFullYear() + 543;
                const shortM = ["ม.ค.", "ก.พ.", "มี.ค.", "เม.ย.", "พ.ค.", "มิ.ย.", "ก.ค.", "ส.ค.", "ก.ย.", "ต.ค.", "พ.ย.", "ธ.ค."][future.getMonth()];
                return { 
                    text: `${d} ${shortM} ${String(y).slice(-2)}`, 
                    key: formatDateKey(future),
                    dateObj: future
                };
            };

            const scrollToDate = (dateInfo) => {
                const targetDate = dateInfo.dateObj;
                const targetKey = dateInfo.key;
                const dayOfWeek = targetDate.getDay();
                if (dayOfWeek === 0 || dayOfWeek === 6) { setToastMsg(`อุ๊ย! ${dateInfo.text} เป็นเสาร์-อาทิตย์`); return; }
                if (targetDate.getFullYear() !== currentYear) {
                    setCurrentYear(targetDate.getFullYear());
                    setTimeout(() => attemptScroll(targetKey), 400);
                    setToastMsg(`วาร์ปไปปี ${targetDate.getFullYear() + 543} แล้วนะ!`);
                } else {
                    attemptScroll(targetKey);
                }
            };

            const attemptScroll = (elementId) => {
                const element = document.getElementById(elementId);
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    setHighlightedDate(elementId);
                } else {
                    setToastMsg("หาไม่เจอ ลองเปลี่ยนปีดูนะ");
                }
            };

            const weeksArray = Array.from({length: 52}, (_, i) => i + 1);

            const renderMonth = (monthIndex) => {
                const year = currentYear;
                const daysInMonth = new Date(year, monthIndex + 1, 0).getDate();
                const days = [];
                let hasRenderedFirstDay = false;

                for (let d = 1; d <= daysInMonth; d++) {
                    const dateObj = new Date(year, monthIndex, d);
                    const dayOfWeek = dateObj.getDay(); 
                    if (dayOfWeek === 0 || dayOfWeek === 6) continue;

                    if (!hasRenderedFirstDay) {
                        const spacerCount = dayOfWeek - 1; 
                        for(let s=0; s<spacerCount; s++) days.push(<div key={`spacer-${monthIndex}-${s}`} className="h-32 bg-gray-50/20"></div>);
                        hasRenderedFirstDay = true;
                    }

                    const dateKey = formatDateKey(dateObj);
                    const opdCount = appointments[dateKey] || 0;
                    const procCount = procedures[dateKey] || 0;
                    const isToday = dateKey === todayStr;
                    
                    const officialName = officialHolidays[dateKey];
                    const isUserHoliday = userHolidays[dateKey];
                    const isHoliday = !!officialName || isUserHoliday;
                    
                    const isWalkIn = walkIns[dateKey];
                    const isHighlighted = highlightedDate === dateKey;

                    let bgClass = "bg-white border-gray-200";
                    if (isWalkIn) bgClass = "bg-pattern-walkin border-amber-300 ring-1 ring-amber-300"; 
                    if (isUserHoliday) bgClass = "bg-pattern-holiday border-red-100 ring-0"; 
                    if (officialName) bgClass = "bg-pattern-official border-pink-200 ring-0";
                    if (isToday && !isHoliday && !isWalkIn) bgClass = "bg-teal-50 border-teal-300 ring-2 ring-teal-400 z-10";
                    if (isHighlighted) bgClass = "warp-highlight";

                    days.push(
                        <div key={dateKey} id={dateKey} className={`relative h-32 border p-1.5 flex flex-col justify-between rounded-lg transition-all duration-300 ${bgClass}`}>
                            <div className="flex justify-between items-start mb-1">
                                <div className="flex items-center gap-1">
                                    <span className={`w-6 h-6 flex items-center justify-center rounded-full text-sm font-bold shadow-sm ${isToday ? 'bg-teal-600 text-white' : 'bg-gray-100 text-gray-600'}`}>{d}</span>
                                </div>
                                <div className="flex gap-1">
                                    {!isHoliday && (
                                        <button onClick={() => toggleWalkIn(dateKey)} className={`p-1 rounded-full transition-colors ${isWalkIn ? 'bg-amber-400 text-white shadow-md transform scale-110' : 'text-gray-300 hover:text-amber-400 hover:bg-amber-50'}`} title="Walk-in"><IconWalk /></button>
                                    )}
                                    <button onClick={() => toggleUserHoliday(dateKey)} className={`p-1 rounded-full transition-colors ${isUserHoliday ? 'text-red-500 bg-red-50' : 'text-gray-300 hover:text-red-400 hover:bg-red-50'}`} title="วันหยุด (กำหนดเอง)">{isUserHoliday ? <IconLock /> : <IconUnlock />}</button>
                                </div>
                            </div>

                            {officialName ? (
                                <div className="flex-grow flex flex-col items-center justify-center text-center">
                                    <span className="text-xs font-bold text-pink-500 bg-white/80 px-2 py-0.5 rounded-full border border-pink-100 shadow-sm mb-1 line-clamp-2">
                                        {officialName}
                                    </span>
                                    {isUserHoliday && <span className="text-[10px] text-red-400">(ล็อคเพิ่ม)</span>}
                                </div>
                            ) : isUserHoliday ? (
                                <div className="flex-grow flex items-center justify-center">
                                    <span className="text-sm font-bold text-red-400 bg-white/90 px-3 py-1 rounded-full border border-red-200 shadow-sm -rotate-3">งดตรวจ</span>
                                </div>
                            ) : (
                                <div className="flex-grow flex flex-col gap-1.5">
                                    {isWalkIn && <div className="text-[10px] text-center font-bold text-amber-600 bg-amber-100/50 rounded -mt-1 mb-1">⚠️ Walk-in</div>}
                                    
                                    {/* OPD ROW */}
                                    <div className={`flex items-center justify-between rounded px-1 py-0.5 border ${isWalkIn ? 'bg-white/60 border-orange-200' : 'bg-orange-50/50 border-orange-100'}`}>
                                        <div className="flex items-center gap-1"><span className="text-orange-400"><IconUser /></span></div>
                                        <div className="flex items-center gap-1">
                                            <button onClick={() => updateCount(dateKey, 'opd', -1)} className="text-orange-300 hover:text-orange-600 hover:bg-orange-100 rounded"><IconMinus /></button>
                                            
                                            {/* DIRECT INPUT */}
                                            <input 
                                                type="number" 
                                                value={opdCount === 0 ? '' : opdCount}
                                                onChange={(e) => handleManualInput(dateKey, 'opd', e.target.value)}
                                                onFocus={(e) => e.target.select()} // Auto-select on click
                                                placeholder="0"
                                                className={`text-sm font-bold w-6 text-center bg-transparent outline-none p-0 ${opdCount > 0 ? 'text-orange-600' : 'text-gray-300'}`}
                                            />

                                            <button onClick={() => updateCount(dateKey, 'opd', 1)} className="text-orange-300 hover:text-orange-600 hover:bg-orange-100 rounded"><IconPlus /></button>
                                        </div>
                                    </div>
                                    
                                    {/* PROCEDURE ROW */}
                                    <div className={`flex items-center justify-between rounded px-1 py-0.5 border ${isWalkIn ? 'bg-white/60 border-blue-200' : 'bg-blue-50/50 border-blue-100'}`}>
                                        <div className="flex items-center gap-1"><span className="text-blue-400"><IconProcedure /></span></div>
                                        <div className="flex items-center gap-1">
                                            <button onClick={() => updateCount(dateKey, 'proc', -1)} className="text-blue-300 hover:text-blue-600 hover:bg-blue-100 rounded"><IconMinus /></button>
                                            
                                            {/* DIRECT INPUT */}
                                            <input 
                                                type="number" 
                                                value={procCount === 0 ? '' : procCount}
                                                onChange={(e) => handleManualInput(dateKey, 'proc', e.target.value)}
                                                onFocus={(e) => e.target.select()}
                                                placeholder="0"
                                                className={`text-sm font-bold w-6 text-center bg-transparent outline-none p-0 ${procCount > 0 ? 'text-blue-600' : 'text-gray-300'}`}
                                            />

                                            <button onClick={() => updateCount(dateKey, 'proc', 1)} className="text-blue-300 hover:text-blue-600 hover:bg-blue-100 rounded"><IconPlus /></button>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    );
                }
                return days;
            };

            return (
                <div className="h-screen bg-gray-50 flex flex-col max-w-xl mx-auto shadow-2xl overflow-hidden border-x border-gray-200 relative">
                    {toastMsg && <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-xl z-50 text-sm font-bold animate-bounce text-center w-64">{toastMsg}</div>}

                    {/* Header */}
                    <div className="bg-teal-700 text-white p-3 z-30 shadow-md">
                        <div className="flex justify-between items-start mb-2">
                            <div>
                                <h1 className="text-lg font-bold flex items-center gap-2">
                                    <IconCalendar /> ตารางนัดหมอต้อง
                                </h1>
                                <p className="text-xs text-teal-200 mt-1">ยอดรวมเฉพาะ: วันนี้ & อนาคต</p>
                            </div>
                            <div className="flex gap-3 text-right">
                                <div><div className="text-2xl font-bold leading-none">{totalOpd}</div><span className="text-[10px] text-teal-200">นัด (เหลือ)</span></div>
                                <div className="border-l border-teal-500 pl-3"><div className="text-2xl font-bold leading-none">{totalProc}</div><span className="text-[10px] text-teal-200">หัตถการ (เหลือ)</span></div>
                            </div>
                        </div>
                    </div>

                    {/* Calculator Bar */}
                    <div className="bg-white border-b border-gray-200 z-20 shadow-sm flex flex-col">
                        <div className="flex items-center gap-2 text-teal-700 font-bold text-xs p-2 pb-0">
                            <IconCalculator /> <span>เริ่มนับจาก:</span>
                            <input type="date" value={calcBaseDate} onChange={(e) => setCalcBaseDate(e.target.value)} className="border border-gray-300 rounded px-2 py-0.5 text-xs bg-gray-50 text-gray-600 outline-none focus:border-teal-500" />
                        </div>
                        <div className="flex overflow-x-auto gap-2 p-2 no-scrollbar snap-x">
                            {weeksArray.map(w => {
                                const info = getFutureDateInfo(w);
                                return (
                                    <button key={w} onClick={() => scrollToDate(info)} className={`flex-shrink-0 flex flex-col items-center justify-center p-1.5 w-16 rounded border snap-start active:scale-95 transition-transform ${w%4 === 0 ? 'bg-indigo-50 border-indigo-200 text-indigo-700' : w%4 === 1 ? 'bg-pink-50 border-pink-200 text-pink-700' : w%4 === 2 ? 'bg-purple-50 border-purple-200 text-purple-700' : 'bg-blue-50 border-blue-200 text-blue-700'}`}>
                                        <span className="text-[10px] opacity-70 font-bold">{w} วีค</span>
                                        <span className="text-xs font-bold whitespace-nowrap">{info.text}</span>
                                    </button>
                                );
                            })}
                        </div>
                    </div>

                    {/* Year Navigator */}
                    <div className="flex items-center justify-between px-4 py-2 bg-gray-100 border-b border-gray-300 z-20">
                        <button onClick={() => changeYear(-1)} className="p-1.5 bg-white border border-gray-300 rounded hover:text-teal-600 shadow-sm"><IconLeft /></button>
                        <h2 className="text-lg font-bold text-gray-800">พ.ศ. <span className="text-teal-700">{currentYear + 543}</span></h2>
                        <button onClick={() => changeYear(1)} className="p-1.5 bg-white border border-gray-300 rounded hover:text-teal-600 shadow-sm"><IconRight /></button>
                    </div>

                    {/* Scrollable Area */}
                    <div className="flex-grow overflow-y-auto bg-gray-50 pb-20 relative" ref={scrollContainerRef}>
                        {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11].map(monthIndex => (
                            <div key={monthIndex} id={`month-${monthIndex}`} className="mb-4">
                                <div className="sticky-month-header px-4 py-2 flex justify-between items-center">
                                    <span className="font-bold text-teal-800 text-lg">{ThaiMonths[monthIndex]}</span>
                                    <span className="text-xs text-gray-400 font-normal">{currentYear + 543}</span>
                                </div>
                                <div className="px-2">
                                    <div className="grid grid-cols-5 gap-1 mb-2 mt-2">
                                        {ThaiDaysMonFri.map((d, i) => (<div key={i} className="text-center text-[10px] font-bold text-gray-400">{d}</div>))}
                                    </div>
                                    <div className="calendar-grid-5">
                                        {renderMonth(monthIndex)}
                                    </div>
                                </div>
                            </div>
                        ))}
                        <div className="h-20 flex items-center justify-center text-gray-300 text-xs">- KramKram x Doctor Tong -</div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


